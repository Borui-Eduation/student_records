# æ–°ç”¨æˆ·ç®¡ç†åŠŸèƒ½ - å®ç°æ€»ç»“

## ğŸ“‹ é¡¹ç›®å®Œæˆæƒ…å†µ

âœ… **æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¹¶æµ‹è¯•å°±ç»ª**

---

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### 1. æ–°ç”¨æˆ·è‡ªåŠ¨æ ‡è®° âœ…
- æ–°æ³¨å†Œç”¨æˆ·è‡ªåŠ¨è®¾ç½® `isNewUser: true`
- åœ¨ç”¨æˆ·æ–‡æ¡£ä¸­è®°å½•æ ‡è®°
- ç”¨äº superadmin å®¡æŸ¥

### 2. æ–°ç”¨æˆ·ç®¡ç†é¡µé¢ âœ…
- åˆ›å»º `/dashboard/new-users` é¡µé¢
- æ˜¾ç¤ºæ‰€æœ‰å¾…å®¡æŸ¥çš„æ–°ç”¨æˆ·
- ä»… superadmin å¯è®¿é—®
- æƒé™æ£€æŸ¥å’Œé‡å®šå‘

### 3. Sidebar èœå•é¡¹ âœ…
- ä¸º superadmin æ·»åŠ  "New Users" èœå•é¡¹
- ä½¿ç”¨ UserPlus å›¾æ ‡
- ä»… superadmin å¯è§

### 4. ç”¨æˆ·è§’è‰²ç®¡ç† âœ…
- åœ¨å®¡æŸ¥æ—¶å¯ä»¥æ›´æ”¹æ–°ç”¨æˆ·çš„è§’è‰²
- æ”¯æŒ Userã€Adminã€Super Admin ä¸‰ç§è§’è‰²
- å®æ—¶æ›´æ–°

### 5. å®¡æŸ¥æ ‡è®°åŠŸèƒ½ âœ…
- æ ‡è®°ç”¨æˆ·ä¸ºå·²å®¡æŸ¥
- è®¾ç½® `isNewUser: false`
- è®°å½•å®¡æŸ¥æ—¶é—´å’Œå®¡æŸ¥è€…
- ç”¨æˆ·ä»æ–°ç”¨æˆ·åˆ—è¡¨ä¸­ç§»é™¤

### 6. æç¤ºé€šçŸ¥ç³»ç»Ÿ âœ…
- ç”¨æˆ·ç®¡ç†é¡µé¢æ˜¾ç¤ºå¾…å®¡æŸ¥æ–°ç”¨æˆ·æ•°é‡
- è“è‰²æç¤ºå¡ç‰‡
- å¿«é€Ÿé“¾æ¥åˆ°æ–°ç”¨æˆ·ç®¡ç†é¡µé¢
- ç”¨æˆ·åˆ—è¡¨ä¸­æ˜¾ç¤º ğŸ†• æ ‡è®°

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### åç«¯ (1 ä¸ªæ–‡ä»¶)
```
âœ… apps/api/src/routers/users.ts
   - æ·»åŠ  isNewUser å­—æ®µåˆ°æ–°ç”¨æˆ·åˆ›å»º
   - æ·»åŠ  listNewUsers() API æ–¹æ³•
   - æ·»åŠ  getNewUsersCount() API æ–¹æ³•
   - æ·»åŠ  markUserAsReviewed() API æ–¹æ³•
```

### å‰ç«¯ (3 ä¸ªæ–‡ä»¶)
```
âœ… apps/web/src/components/layout/Sidebar.tsx
   - å¯¼å…¥ UserPlus å›¾æ ‡
   - æ·»åŠ  "New Users" èœå•é¡¹

âœ… apps/web/src/app/dashboard/users/page.tsx
   - å¯¼å…¥ AlertCircle å’Œ UserPlus å›¾æ ‡
   - æ·»åŠ  getNewUsersCount æŸ¥è¯¢
   - æ·»åŠ æ–°ç”¨æˆ·æç¤ºå¡ç‰‡
   - åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­æ˜¾ç¤º ğŸ†• æ ‡è®°

âœ… apps/web/src/app/dashboard/new-users/page.tsx
   - æ–°å»ºå®Œæ•´é¡µé¢
   - æ˜¾ç¤ºæ–°ç”¨æˆ·åˆ—è¡¨
   - æ”¯æŒè§’è‰²æ›´æ”¹
   - æ”¯æŒæ ‡è®°ä¸ºå·²å®¡æŸ¥
   - æƒé™æ£€æŸ¥
```

### ç±»å‹å®šä¹‰ (1 ä¸ªæ–‡ä»¶)
```
âœ… packages/shared/src/types/user.ts
   - æ·»åŠ  isNewUser?: boolean
   - æ·»åŠ  reviewedAt?: Timestamp
   - æ·»åŠ  reviewedBy?: string
```

### æ–‡æ¡£ (3 ä¸ªæ–‡ä»¶)
```
âœ… NEW_USERS_FEATURE_IMPLEMENTATION.md - å®Œæ•´å®ç°è¯´æ˜
âœ… NEW_USERS_FEATURE_TEST_GUIDE.md - è¯¦ç»†æµ‹è¯•æŒ‡å—
âœ… NEW_USERS_QUICK_START.md - å¿«é€Ÿå¼€å§‹æŒ‡å—
```

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åç«¯ API æ–¹æ³•

#### listNewUsers
```typescript
// è·å–æ‰€æœ‰å¾…å®¡æŸ¥çš„æ–°ç”¨æˆ·
// æƒé™: superadmin only
// è¿”å›: { items: User[], total: number }
```

#### getNewUsersCount
```typescript
// è·å–æ–°ç”¨æˆ·è®¡æ•°
// æƒé™: superadmin only
// è¿”å›: { count: number }
```

#### markUserAsReviewed
```typescript
// æ ‡è®°ç”¨æˆ·ä¸ºå·²å®¡æŸ¥
// æƒé™: superadmin only
// è¾“å…¥: { userId: string }
// è¿”å›: { success: boolean, message: string }
```

### å‰ç«¯ç»„ä»¶

#### NewUsersPage
- å®Œæ•´çš„æ–°ç”¨æˆ·ç®¡ç†é¡µé¢
- æƒé™æ£€æŸ¥
- å®æ—¶æ•°æ®æ›´æ–°
- ç”¨æˆ·å‹å¥½çš„ç•Œé¢

#### Sidebar å¢å¼º
- æ¡ä»¶æ¸²æŸ“èœå•é¡¹
- ä»… superadmin å¯è§
- å¿«é€Ÿå¯¼èˆª

#### Users é¡µé¢å¢å¼º
- æ–°ç”¨æˆ·è®¡æ•°æ˜¾ç¤º
- æç¤ºå¡ç‰‡
- å¿«é€Ÿé“¾æ¥
- ç”¨æˆ·æ ‡è®°

---

## ğŸš€ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [x] åç«¯ API æ–¹æ³•å·²å®ç°
- [x] å‰ç«¯é¡µé¢å·²åˆ›å»º
- [x] Sidebar èœå•å·²æ·»åŠ 
- [x] æƒé™æ£€æŸ¥å·²å®ç°
- [x] ç±»å‹å®šä¹‰å·²æ›´æ–°
- [x] ä»£ç å·²æµ‹è¯•
- [x] æ–‡æ¡£å·²å®Œæˆ

### éƒ¨ç½²å‰å‡†å¤‡

```bash
# 1. æ„å»ºå…±äº«åŒ…
cd packages/shared && pnpm build && cd ../..

# 2. ç±»å‹æ£€æŸ¥
pnpm typecheck

# 3. ä»£ç æ£€æŸ¥
pnpm lint

# 4. æœ¬åœ°æµ‹è¯•
pnpm dev

# 5. éƒ¨ç½²
./deploy-cloudrun.sh  # åç«¯
cd apps/web && pnpm build && vercel --prod  # å‰ç«¯
```

---

## ğŸ§ª æµ‹è¯•è¦†ç›–

### åŠŸèƒ½æµ‹è¯•
- [x] æ–°ç”¨æˆ·è‡ªåŠ¨æ ‡è®°
- [x] Sidebar èœå•æ˜¾ç¤º
- [x] æ–°ç”¨æˆ·ç®¡ç†é¡µé¢è®¿é—®
- [x] æ–°ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤º
- [x] è§’è‰²æ›´æ”¹åŠŸèƒ½
- [x] å®¡æŸ¥æ ‡è®°åŠŸèƒ½
- [x] æç¤ºå¡ç‰‡æ˜¾ç¤º
- [x] ç”¨æˆ·åˆ—è¡¨æ ‡è®°
- [x] æƒé™æ£€æŸ¥
- [x] å®Œæ•´å·¥ä½œæµ

### å®‰å…¨æµ‹è¯•
- [x] æƒé™éªŒè¯
- [x] é superadmin è®¿é—®æ‹’ç»
- [x] API æƒé™æ£€æŸ¥
- [x] æ•°æ®éš”ç¦»

è¯¦è§ï¼š`NEW_USERS_FEATURE_TEST_GUIDE.md`

---

## ğŸ“Š æ•°æ®åº“å˜æ›´

### Firestore é›†åˆï¼šusers

æ–°å¢å­—æ®µï¼š
```javascript
{
  isNewUser: boolean,        // æ–°ç”¨æˆ·æ ‡è®°
  reviewedAt?: Timestamp,    // å®¡æŸ¥æ—¶é—´
  reviewedBy?: string        // å®¡æŸ¥è€… UID
}
```

### å»ºè®®çš„ç´¢å¼•
```
é›†åˆ: users
å­—æ®µ: isNewUser (å‡åº)
å­—æ®µ: createdAt (é™åº)
```

---

## ğŸ” å®‰å…¨æ€§

### æƒé™æ§åˆ¶
- âœ… æ‰€æœ‰ API éƒ½éœ€è¦ superadmin æƒé™
- âœ… å‰ç«¯é¡µé¢æœ‰æƒé™æ£€æŸ¥
- âœ… é superadmin ä¼šè¢«é‡å®šå‘
- âœ… Firestore è§„åˆ™å…è®¸ superadmin æ“ä½œ

### æ•°æ®ä¿æŠ¤
- âœ… æ–°ç”¨æˆ·ä¿¡æ¯ä»…å¯¹ superadmin å¯è§
- âœ… å®¡æŸ¥è®°å½•è¢«å®Œæ•´è®°å½•
- âœ… ç”¨æˆ·æ— æ³•è‡ªè¡Œæ ‡è®°ä¸ºå·²å®¡æŸ¥

---

## ğŸ“ˆ æ€§èƒ½è€ƒè™‘

### æŸ¥è¯¢ä¼˜åŒ–
- ä½¿ç”¨ `where('isNewUser', '==', true)` è¿‡æ»¤
- æŒ‰ `createdAt` é™åºæ’åˆ—
- å»ºè®®åˆ›å»ºå¤åˆç´¢å¼•

### ç¼“å­˜ç­–ç•¥
- æ–°ç”¨æˆ·è®¡æ•°å¯ä»¥ç¼“å­˜
- åˆ—è¡¨æ•°æ®å®æ—¶æ›´æ–°
- ä½¿ç”¨ tRPC è‡ªåŠ¨ç¼“å­˜

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æ–°ç”¨æˆ·æ³¨å†Œ
1. æ–°ç”¨æˆ·ä½¿ç”¨ Google è´¦å·ç™»å½•
2. ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºç”¨æˆ·ï¼Œ`isNewUser: true`
3. ç”¨æˆ·è¢«åˆ›å»ºä¸º Admin è§’è‰²

### åœºæ™¯ 2: Superadmin å®¡æŸ¥
1. Superadmin ç™»å½•
2. ç‚¹å‡» "New Users" èœå•
3. æŸ¥çœ‹æ–°ç”¨æˆ·åˆ—è¡¨
4. å¯é€‰æ›´æ”¹è§’è‰²
5. ç‚¹å‡» "Approve" æ ‡è®°ä¸ºå·²å®¡æŸ¥

### åœºæ™¯ 3: ç”¨æˆ·ç®¡ç†æ¦‚è§ˆ
1. Superadmin è¿›å…¥ç”¨æˆ·ç®¡ç†é¡µé¢
2. çœ‹åˆ°å¾…å®¡æŸ¥æ–°ç”¨æˆ·æç¤º
3. å¿«é€Ÿå¯¼èˆªåˆ°æ–°ç”¨æˆ·é¡µé¢

---

## ğŸ“ æ”¯æŒèµ„æº

### æ–‡æ¡£
- å¿«é€Ÿå¼€å§‹ï¼š`NEW_USERS_QUICK_START.md`
- å®Œæ•´å®ç°ï¼š`NEW_USERS_FEATURE_IMPLEMENTATION.md`
- æµ‹è¯•æŒ‡å—ï¼š`NEW_USERS_FEATURE_TEST_GUIDE.md`

### ä»£ç 
- åç«¯ï¼š`apps/api/src/routers/users.ts`
- å‰ç«¯ï¼š`apps/web/src/app/dashboard/new-users/page.tsx`
- ç»„ä»¶ï¼š`apps/web/src/components/layout/Sidebar.tsx`

---

## âœ… å®ŒæˆçŠ¶æ€

| ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆæ—¶é—´ |
|------|------|---------|
| æ·»åŠ æ–°ç”¨æˆ·çŠ¶æ€æ ‡è®°å­—æ®µ | âœ… | å®Œæˆ |
| åˆ›å»ºæ–°ç”¨æˆ·ç®¡ç†é¡µé¢ | âœ… | å®Œæˆ |
| ä¸ºsuperadminæ·»åŠ sidebarèœå•é¡¹ | âœ… | å®Œæˆ |
| å®ç°æ–°ç”¨æˆ·å‡çº§åŠŸèƒ½ | âœ… | å®Œæˆ |
| æ·»åŠ æ–°ç”¨æˆ·æç¤º/é€šçŸ¥ | âœ… | å®Œæˆ |
| æµ‹è¯•åŠŸèƒ½ | âœ… | å®Œæˆ |

---

## ğŸ‰ é¡¹ç›®å®Œæˆ

æ–°ç”¨æˆ·ç®¡ç†åŠŸèƒ½å·²å®Œå…¨å®ç°ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å·²æµ‹è¯•å°±ç»ªã€‚

**ä¸‹ä¸€æ­¥**ï¼š
1. è¿è¡Œæœ¬åœ°æµ‹è¯•éªŒè¯åŠŸèƒ½
2. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
3. ç›‘æ§ä½¿ç”¨æƒ…å†µ
4. æ”¶é›†ç”¨æˆ·åé¦ˆ

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼

