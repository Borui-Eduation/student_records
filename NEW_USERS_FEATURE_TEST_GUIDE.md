# æ–°ç”¨æˆ·ç®¡ç†åŠŸèƒ½æµ‹è¯•æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

æœ¬åŠŸèƒ½ä¸º superadmin æ·»åŠ äº†æ–°ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

1. **æ–°ç”¨æˆ·æ ‡è®°** - æ–°æ³¨å†Œç”¨æˆ·è‡ªåŠ¨æ ‡è®°ä¸º `isNewUser: true`
2. **æ–°ç”¨æˆ·ç®¡ç†é¡µé¢** - `/dashboard/new-users` é¡µé¢æ˜¾ç¤ºæ‰€æœ‰å¾…å®¡æŸ¥çš„æ–°ç”¨æˆ·
3. **Sidebar èœå•** - ä¸º superadmin æ·»åŠ  "New Users" èœå•é¡¹
4. **ç”¨æˆ·å‡çº§åŠŸèƒ½** - superadmin å¯ä»¥åœ¨å®¡æŸ¥æ—¶æ›´æ”¹æ–°ç”¨æˆ·çš„è§’è‰²
5. **å®¡æŸ¥æ ‡è®°** - superadmin å¯ä»¥æ ‡è®°ç”¨æˆ·ä¸ºå·²å®¡æŸ¥ï¼Œå°†å…¶ä»æ–°ç”¨æˆ·åˆ—è¡¨ä¸­ç§»é™¤
6. **æç¤ºé€šçŸ¥** - ç”¨æˆ·ç®¡ç†é¡µé¢æ˜¾ç¤ºå¾…å®¡æŸ¥æ–°ç”¨æˆ·çš„æ•°é‡å’Œå¿«é€Ÿé“¾æ¥

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### å‰ç½®æ¡ä»¶

1. ç¡®ä¿ superadmin è´¦å·å·²é…ç½®ï¼š`yao.s.1216@gmail.com`
2. è¿è¡Œæœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼š`pnpm dev`
3. å‰ç«¯è®¿é—®ï¼šhttp://localhost:3000
4. åç«¯ APIï¼šhttp://localhost:8080

### æµ‹è¯• 1: æ–°ç”¨æˆ·æ³¨å†Œå’Œæ ‡è®°

**ç›®æ ‡**: éªŒè¯æ–°ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨æ ‡è®°ä¸º `isNewUser: true`

**æ­¥éª¤**:
1. ä½¿ç”¨æ–°çš„ Gmail è´¦å·ç™»å½•åº”ç”¨
2. åº”è¯¥èƒ½æˆåŠŸè¿›å…¥ dashboard
3. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
4. åœ¨ Firestore ä¸­æŸ¥çœ‹ç”¨æˆ·æ–‡æ¡£ï¼š
   - æ‰“å¼€ Firebase Console
   - å¯¼èˆªåˆ° Firestore Database
   - æŸ¥çœ‹ `users` é›†åˆä¸­çš„æ–°ç”¨æˆ·æ–‡æ¡£
   - éªŒè¯ `isNewUser: true` å­—æ®µå­˜åœ¨

**é¢„æœŸç»“æœ**: âœ… æ–°ç”¨æˆ·æ–‡æ¡£åŒ…å« `isNewUser: true`

---

### æµ‹è¯• 2: Sidebar èœå•é¡¹

**ç›®æ ‡**: éªŒè¯ superadmin å¯ä»¥çœ‹åˆ° "New Users" èœå•é¡¹

**æ­¥éª¤**:
1. ä½¿ç”¨ superadmin è´¦å·ç™»å½• (yao.s.1216@gmail.com)
2. è¿›å…¥ dashboard
3. æŸ¥çœ‹å·¦ä¾§ sidebar
4. åº”è¯¥çœ‹åˆ° "New Users" èœå•é¡¹ï¼ˆå¸¦ UserPlus å›¾æ ‡ï¼‰

**é¢„æœŸç»“æœ**: âœ… Sidebar ä¸­æ˜¾ç¤º "New Users" èœå•é¡¹

---

### æµ‹è¯• 3: æ–°ç”¨æˆ·ç®¡ç†é¡µé¢

**ç›®æ ‡**: éªŒè¯æ–°ç”¨æˆ·ç®¡ç†é¡µé¢æ­£ç¡®æ˜¾ç¤ºæ–°ç”¨æˆ·åˆ—è¡¨

**æ­¥éª¤**:
1. ä½¿ç”¨ superadmin è´¦å·ç™»å½•
2. ç‚¹å‡» sidebar ä¸­çš„ "New Users" èœå•é¡¹
3. åº”è¯¥è¿›å…¥ `/dashboard/new-users` é¡µé¢
4. é¡µé¢åº”è¯¥æ˜¾ç¤ºï¼š
   - æ ‡é¢˜ï¼š"New Users"
   - å¾…å®¡æŸ¥æ–°ç”¨æˆ·çš„æ•°é‡
   - æ–°ç”¨æˆ·åˆ—è¡¨ï¼ˆå¦‚æœæœ‰æ–°ç”¨æˆ·ï¼‰

**é¢„æœŸç»“æœ**: âœ… é¡µé¢æ­£ç¡®åŠ è½½å¹¶æ˜¾ç¤ºæ–°ç”¨æˆ·åˆ—è¡¨

---

### æµ‹è¯• 4: æ–°ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤º

**ç›®æ ‡**: éªŒè¯æ–°ç”¨æˆ·åœ¨åˆ—è¡¨ä¸­æ­£ç¡®æ˜¾ç¤º

**æ­¥éª¤**:
1. åœ¨æ–°ç”¨æˆ·ç®¡ç†é¡µé¢ä¸­
2. åº”è¯¥çœ‹åˆ°æ–°ç”¨æˆ·çš„ï¼š
   - é‚®ç®±åœ°å€
   - ğŸ†• New User æ ‡è®°ï¼ˆè“è‰² badgeï¼‰
   - æ³¨å†Œæ—¶é—´
   - å½“å‰è§’è‰²ï¼ˆé»˜è®¤ä¸º Adminï¼‰
   - è§’è‰²é€‰æ‹©ä¸‹æ‹‰èœå•
   - "Approve" æŒ‰é’®

**é¢„æœŸç»“æœ**: âœ… æ–°ç”¨æˆ·ä¿¡æ¯å®Œæ•´æ˜¾ç¤º

---

### æµ‹è¯• 5: æ›´æ”¹æ–°ç”¨æˆ·è§’è‰²

**ç›®æ ‡**: éªŒè¯ superadmin å¯ä»¥åœ¨å®¡æŸ¥æ—¶æ›´æ”¹æ–°ç”¨æˆ·çš„è§’è‰²

**æ­¥éª¤**:
1. åœ¨æ–°ç”¨æˆ·ç®¡ç†é¡µé¢ä¸­
2. é€‰æ‹©ä¸€ä¸ªæ–°ç”¨æˆ·
3. ç‚¹å‡»è§’è‰²ä¸‹æ‹‰èœå•
4. é€‰æ‹©ä¸åŒçš„è§’è‰²ï¼ˆä¾‹å¦‚ï¼šUser æˆ– Super Adminï¼‰
5. åº”è¯¥çœ‹åˆ°æˆåŠŸæç¤º
6. åœ¨ Firestore ä¸­éªŒè¯è§’è‰²å·²æ›´æ–°

**é¢„æœŸç»“æœ**: âœ… ç”¨æˆ·è§’è‰²æˆåŠŸæ›´æ–°

---

### æµ‹è¯• 6: æ ‡è®°ç”¨æˆ·ä¸ºå·²å®¡æŸ¥

**ç›®æ ‡**: éªŒè¯ superadmin å¯ä»¥æ ‡è®°ç”¨æˆ·ä¸ºå·²å®¡æŸ¥

**æ­¥éª¤**:
1. åœ¨æ–°ç”¨æˆ·ç®¡ç†é¡µé¢ä¸­
2. é€‰æ‹©ä¸€ä¸ªæ–°ç”¨æˆ·
3. ç‚¹å‡» "Approve" æŒ‰é’®
4. åº”è¯¥çœ‹åˆ°æˆåŠŸæç¤º
5. ç”¨æˆ·åº”è¯¥ä»æ–°ç”¨æˆ·åˆ—è¡¨ä¸­æ¶ˆå¤±
6. åœ¨ Firestore ä¸­éªŒè¯ï¼š
   - `isNewUser: false`
   - `reviewedAt` å­—æ®µå·²è®¾ç½®
   - `reviewedBy` å­—æ®µåŒ…å« superadmin çš„ UID

**é¢„æœŸç»“æœ**: âœ… ç”¨æˆ·æ ‡è®°ä¸ºå·²å®¡æŸ¥å¹¶ä»åˆ—è¡¨ä¸­ç§»é™¤

---

### æµ‹è¯• 7: ç”¨æˆ·ç®¡ç†é¡µé¢æç¤º

**ç›®æ ‡**: éªŒè¯ç”¨æˆ·ç®¡ç†é¡µé¢æ˜¾ç¤ºæ–°ç”¨æˆ·æç¤º

**æ­¥éª¤**:
1. ä½¿ç”¨ superadmin è´¦å·ç™»å½•
2. è¿›å…¥ User Management é¡µé¢ (`/dashboard/users`)
3. å¦‚æœæœ‰å¾…å®¡æŸ¥çš„æ–°ç”¨æˆ·ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   - è“è‰²æç¤ºå¡ç‰‡
   - æ˜¾ç¤ºæ–°ç”¨æˆ·æ•°é‡
   - "Review" æŒ‰é’®é“¾æ¥åˆ°æ–°ç”¨æˆ·é¡µé¢
4. ç‚¹å‡» "Review" æŒ‰é’®åº”è¯¥å¯¼èˆªåˆ°æ–°ç”¨æˆ·é¡µé¢

**é¢„æœŸç»“æœ**: âœ… æç¤ºå¡ç‰‡æ­£ç¡®æ˜¾ç¤ºå¹¶å¯ç‚¹å‡»

---

### æµ‹è¯• 8: ç”¨æˆ·åˆ—è¡¨ä¸­çš„æ–°ç”¨æˆ·æ ‡è®°

**ç›®æ ‡**: éªŒè¯ç”¨æˆ·ç®¡ç†é¡µé¢ä¸­çš„ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤ºæ–°ç”¨æˆ·æ ‡è®°

**æ­¥éª¤**:
1. åœ¨ç”¨æˆ·ç®¡ç†é¡µé¢ä¸­
2. æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
3. å¯¹äºæ ‡è®°ä¸º `isNewUser: true` çš„ç”¨æˆ·ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   - ğŸ†• New æ ‡è®°ï¼ˆè“è‰² badgeï¼‰
   - æ˜¾ç¤ºåœ¨é‚®ç®±ä¸‹æ–¹

**é¢„æœŸç»“æœ**: âœ… æ–°ç”¨æˆ·æ ‡è®°æ­£ç¡®æ˜¾ç¤º

---

### æµ‹è¯• 9: æƒé™æ£€æŸ¥

**ç›®æ ‡**: éªŒè¯é superadmin ç”¨æˆ·æ— æ³•è®¿é—®æ–°ç”¨æˆ·ç®¡ç†é¡µé¢

**æ­¥éª¤**:
1. ä½¿ç”¨æ™®é€š admin è´¦å·ç™»å½•
2. å°è¯•è®¿é—® `/dashboard/new-users`
3. åº”è¯¥è¢«é‡å®šå‘åˆ° dashboard
4. åº”è¯¥çœ‹åˆ°é”™è¯¯æç¤ºï¼š"Access Denied"
5. Sidebar ä¸­ä¸åº”è¯¥æ˜¾ç¤º "New Users" èœå•é¡¹

**é¢„æœŸç»“æœ**: âœ… æƒé™æ£€æŸ¥æ­£ç¡®å·¥ä½œ

---

### æµ‹è¯• 10: å®Œæ•´å·¥ä½œæµ

**ç›®æ ‡**: éªŒè¯å®Œæ•´çš„æ–°ç”¨æˆ·ç®¡ç†å·¥ä½œæµ

**æ­¥éª¤**:
1. ä½¿ç”¨æ–° Gmail è´¦å·æ³¨å†Œ
2. ä½¿ç”¨ superadmin è´¦å·ç™»å½•
3. è¿›å…¥æ–°ç”¨æˆ·ç®¡ç†é¡µé¢
4. çœ‹åˆ°æ–°ç”¨æˆ·
5. æ›´æ”¹ç”¨æˆ·è§’è‰²ä¸º "User"
6. ç‚¹å‡» "Approve" æŒ‰é’®
7. ç”¨æˆ·ä»æ–°ç”¨æˆ·åˆ—è¡¨ä¸­æ¶ˆå¤±
8. è¿›å…¥ç”¨æˆ·ç®¡ç†é¡µé¢
9. éªŒè¯ç”¨æˆ·å‡ºç°åœ¨ä¸»ç”¨æˆ·åˆ—è¡¨ä¸­
10. éªŒè¯ç”¨æˆ·ä¸å†æœ‰ ğŸ†• æ ‡è®°

**é¢„æœŸç»“æœ**: âœ… å®Œæ•´å·¥ä½œæµæ­£å¸¸è¿è¡Œ

---

## ğŸ“‹ API ç«¯ç‚¹æµ‹è¯•

### 1. è·å–æ–°ç”¨æˆ·åˆ—è¡¨

```bash
curl -X POST http://localhost:8080/trpc/users.listNewUsers \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{}'
```

**é¢„æœŸå“åº”**:
```json
{
  "result": {
    "data": {
      "items": [...],
      "total": 2
    }
  }
}
```

### 2. è·å–æ–°ç”¨æˆ·è®¡æ•°

```bash
curl -X POST http://localhost:8080/trpc/users.getNewUsersCount \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{}'
```

**é¢„æœŸå“åº”**:
```json
{
  "result": {
    "data": {
      "count": 2
    }
  }
}
```

### 3. æ ‡è®°ç”¨æˆ·ä¸ºå·²å®¡æŸ¥

```bash
curl -X POST http://localhost:8080/trpc/users.markUserAsReviewed \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"userId": "USER_ID"}'
```

**é¢„æœŸå“åº”**:
```json
{
  "result": {
    "data": {
      "success": true,
      "message": "User marked as reviewed"
    }
  }
}
```

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: "New Users" èœå•é¡¹ä¸æ˜¾ç¤º

**åŸå› **: ç”¨æˆ·ä¸æ˜¯ superadmin

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ä½¿ç”¨ superadmin è´¦å·ç™»å½•
2. æ£€æŸ¥ Firestore ä¸­ç”¨æˆ·çš„ `role` å­—æ®µæ˜¯å¦ä¸º `superadmin`
3. è¿è¡Œ `node scripts/set-superadmin.js yao.s.1216@gmail.com superadmin`

### é—®é¢˜ 2: æ–°ç”¨æˆ·åˆ—è¡¨ä¸ºç©º

**åŸå› **: æ²¡æœ‰æ–°ç”¨æˆ·æˆ–æ‰€æœ‰ç”¨æˆ·éƒ½å·²å®¡æŸ¥

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨æ–° Gmail è´¦å·æ³¨å†Œ
2. æ£€æŸ¥ Firestore ä¸­æ˜¯å¦æœ‰ `isNewUser: true` çš„ç”¨æˆ·

### é—®é¢˜ 3: æ— æ³•æ›´æ”¹ç”¨æˆ·è§’è‰²

**åŸå› **: æƒé™ä¸è¶³æˆ– API é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ä½¿ç”¨ superadmin è´¦å·
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. æŸ¥çœ‹åç«¯æ—¥å¿—

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æ–°ç”¨æˆ·è‡ªåŠ¨æ ‡è®°ä¸º `isNewUser: true`
- [ ] Sidebar æ˜¾ç¤º "New Users" èœå•é¡¹
- [ ] æ–°ç”¨æˆ·ç®¡ç†é¡µé¢å¯è®¿é—®
- [ ] æ–°ç”¨æˆ·åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- [ ] å¯ä»¥æ›´æ”¹æ–°ç”¨æˆ·è§’è‰²
- [ ] å¯ä»¥æ ‡è®°ç”¨æˆ·ä¸ºå·²å®¡æŸ¥
- [ ] ç”¨æˆ·ç®¡ç†é¡µé¢æ˜¾ç¤ºæ–°ç”¨æˆ·æç¤º
- [ ] ç”¨æˆ·åˆ—è¡¨ä¸­æ˜¾ç¤ºæ–°ç”¨æˆ·æ ‡è®°
- [ ] é superadmin æ— æ³•è®¿é—®æ–°ç”¨æˆ·é¡µé¢
- [ ] å®Œæ•´å·¥ä½œæµæ­£å¸¸è¿è¡Œ

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. åç«¯æ—¥å¿—
3. Firestore æ•°æ®
4. Firebase æƒé™è§„åˆ™

