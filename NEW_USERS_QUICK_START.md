# æ–°ç”¨æˆ·ç®¡ç†åŠŸèƒ½ - å¿«é€Ÿå¼€å§‹

## âœ¨ åŠŸèƒ½äº®ç‚¹

âœ… **è‡ªåŠ¨æ–°ç”¨æˆ·æ ‡è®°** - æ–°æ³¨å†Œç”¨æˆ·è‡ªåŠ¨æ ‡è®°ä¸ºå¾…å®¡æŸ¥  
âœ… **ä¸“å±ç®¡ç†é¡µé¢** - `/dashboard/new-users` é¡µé¢ç®¡ç†æ‰€æœ‰æ–°ç”¨æˆ·  
âœ… **Sidebar èœå•** - å¿«é€Ÿè®¿é—®æ–°ç”¨æˆ·ç®¡ç†  
âœ… **è§’è‰²ç®¡ç†** - å®¡æŸ¥æ—¶å¯ä»¥æ›´æ”¹ç”¨æˆ·è§’è‰²  
âœ… **å®¡æŸ¥æ ‡è®°** - æ ‡è®°ç”¨æˆ·ä¸ºå·²å®¡æŸ¥å¹¶ä»åˆ—è¡¨ä¸­ç§»é™¤  
âœ… **æç¤ºé€šçŸ¥** - ç”¨æˆ·ç®¡ç†é¡µé¢æ˜¾ç¤ºå¾…å®¡æŸ¥æ–°ç”¨æˆ·æ•°é‡  

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. æœ¬åœ°æµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
# æ„å»ºå…±äº«åŒ…
cd packages/shared && pnpm build && cd ../..

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# è®¿é—®åº”ç”¨
# å‰ç«¯: http://localhost:3000
# åç«¯: http://localhost:8080
```

### 2. éªŒè¯åŠŸèƒ½

```bash
# 1. ä½¿ç”¨æ–° Gmail è´¦å·æ³¨å†Œ
# 2. ä½¿ç”¨ superadmin è´¦å·ç™»å½• (yao.s.1216@gmail.com)
# 3. ç‚¹å‡» Sidebar ä¸­çš„ "New Users"
# 4. åº”è¯¥çœ‹åˆ°æ–°ç”¨æˆ·åˆ—è¡¨
```

### 3. ç”Ÿäº§éƒ¨ç½²

```bash
# éƒ¨ç½²åç«¯
./deploy-cloudrun.sh

# éƒ¨ç½²å‰ç«¯
cd apps/web && pnpm build && vercel --prod
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### å¯¹äº Superadmin

#### æŸ¥çœ‹æ–°ç”¨æˆ·
1. ç™»å½•åº”ç”¨
2. ç‚¹å‡» Sidebar ä¸­çš„ **"New Users"** èœå•é¡¹
3. æŸ¥çœ‹æ‰€æœ‰å¾…å®¡æŸ¥çš„æ–°ç”¨æˆ·

#### å®¡æŸ¥æ–°ç”¨æˆ·
1. åœ¨æ–°ç”¨æˆ·åˆ—è¡¨ä¸­æ‰¾åˆ°ç”¨æˆ·
2. å¯é€‰ï¼šä½¿ç”¨ä¸‹æ‹‰èœå•æ›´æ”¹ç”¨æˆ·è§’è‰²
3. ç‚¹å‡» **"Approve"** æŒ‰é’®æ ‡è®°ä¸ºå·²å®¡æŸ¥
4. ç”¨æˆ·å°†ä»æ–°ç”¨æˆ·åˆ—è¡¨ä¸­ç§»é™¤

#### å¿«é€Ÿæ¦‚è§ˆ
1. è¿›å…¥ **"User Management"** é¡µé¢
2. å¦‚æœæœ‰å¾…å®¡æŸ¥æ–°ç”¨æˆ·ï¼Œä¼šçœ‹åˆ°è“è‰²æç¤ºå¡ç‰‡
3. ç‚¹å‡» **"Review"** æŒ‰é’®å¿«é€Ÿå¯¼èˆªåˆ°æ–°ç”¨æˆ·é¡µé¢

### å¯¹äºæ–°ç”¨æˆ·

1. ä½¿ç”¨ Google è´¦å·ç™»å½•
2. è‡ªåŠ¨è¢«åˆ›å»ºä¸º **Admin** è§’è‰²
3. å¯ä»¥ç«‹å³è®¿é—® dashboard
4. ç­‰å¾… superadmin å®¡æŸ¥

---

## ğŸ” å…³é”®ç‰¹æ€§

### æ–°ç”¨æˆ·æ ‡è®°
- æ–°æ³¨å†Œç”¨æˆ·è‡ªåŠ¨è®¾ç½® `isNewUser: true`
- åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­æ˜¾ç¤º ğŸ†• æ ‡è®°
- åœ¨æ–°ç”¨æˆ·ç®¡ç†é¡µé¢ä¸­çªå‡ºæ˜¾ç¤º

### è§’è‰²ç®¡ç†
- æ–°ç”¨æˆ·é»˜è®¤åˆ›å»ºä¸º **Admin** è§’è‰²
- Superadmin å¯ä»¥åœ¨å®¡æŸ¥æ—¶æ›´æ”¹è§’è‰²
- æ”¯æŒçš„è§’è‰²ï¼šUserã€Adminã€Super Admin

### å®¡æŸ¥æµç¨‹
1. æ–°ç”¨æˆ·æ³¨å†Œ â†’ `isNewUser: true`
2. Superadmin å®¡æŸ¥ â†’ å¯é€‰æ›´æ”¹è§’è‰²
3. Superadmin æ‰¹å‡† â†’ `isNewUser: false`
4. ç”¨æˆ·ä»æ–°ç”¨æˆ·åˆ—è¡¨ä¸­ç§»é™¤

### å®¡æŸ¥è®°å½•
- `reviewedAt` - å®¡æŸ¥æ—¶é—´
- `reviewedBy` - å®¡æŸ¥è€… UID
- ç”¨äºå®¡è®¡å’Œè¿½è¸ª

---

## ğŸ“Š æ•°æ®ç»“æ„

### ç”¨æˆ·æ–‡æ¡£æ–°å¢å­—æ®µ

```javascript
{
  id: "firebase-uid",
  email: "user@example.com",
  role: "admin",
  createdAt: Timestamp,
  lastLoginAt: Timestamp,
  isInitialized: false,
  
  // æ–°å¢å­—æ®µ
  isNewUser: true,           // æ–°ç”¨æˆ·æ ‡è®°
  reviewedAt: Timestamp,     // å®¡æŸ¥æ—¶é—´ï¼ˆå¯é€‰ï¼‰
  reviewedBy: "superadmin-uid" // å®¡æŸ¥è€…ï¼ˆå¯é€‰ï¼‰
}
```

---

## ğŸ” æƒé™æ§åˆ¶

### æ–°ç”¨æˆ·ç®¡ç†é¡µé¢
- âœ… Superadmin: å®Œå…¨è®¿é—®
- âŒ Admin: æ— æ³•è®¿é—®ï¼ˆé‡å®šå‘åˆ° dashboardï¼‰
- âŒ User: æ— æ³•è®¿é—®ï¼ˆé‡å®šå‘åˆ° dashboardï¼‰

### Sidebar èœå•
- âœ… Superadmin: æ˜¾ç¤º "New Users" èœå•é¡¹
- âŒ Admin: ä¸æ˜¾ç¤º
- âŒ User: ä¸æ˜¾ç¤º

### API ç«¯ç‚¹
- æ‰€æœ‰æ–°ç”¨æˆ·ç®¡ç† API éƒ½éœ€è¦ superadmin æƒé™
- é superadmin è°ƒç”¨ä¼šè¿”å› 403 Forbidden

---

## ğŸ§ª æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æ–°ç”¨æˆ·è‡ªåŠ¨æ ‡è®°ä¸º `isNewUser: true`
- [ ] Sidebar æ˜¾ç¤º "New Users" èœå•é¡¹
- [ ] æ–°ç”¨æˆ·ç®¡ç†é¡µé¢å¯è®¿é—®
- [ ] æ–°ç”¨æˆ·åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- [ ] å¯ä»¥æ›´æ”¹æ–°ç”¨æˆ·è§’è‰²
- [ ] å¯ä»¥æ ‡è®°ç”¨æˆ·ä¸ºå·²å®¡æŸ¥
- [ ] ç”¨æˆ·ç®¡ç†é¡µé¢æ˜¾ç¤ºæ–°ç”¨æˆ·æç¤º
- [ ] ç”¨æˆ·åˆ—è¡¨ä¸­æ˜¾ç¤ºæ–°ç”¨æˆ·æ ‡è®°
- [ ] é superadmin æ— æ³•è®¿é—®æ–°ç”¨æˆ·é¡µé¢
- [ ] å®Œæ•´å·¥ä½œæµæ­£å¸¸è¿è¡Œ

è¯¦è§ï¼š`NEW_USERS_FEATURE_TEST_GUIDE.md`

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯
```
apps/api/src/routers/users.ts
  âœ… æ·»åŠ  isNewUser å­—æ®µ
  âœ… æ·»åŠ  listNewUsers() æ–¹æ³•
  âœ… æ·»åŠ  getNewUsersCount() æ–¹æ³•
  âœ… æ·»åŠ  markUserAsReviewed() æ–¹æ³•
```

### å‰ç«¯
```
apps/web/src/components/layout/Sidebar.tsx
  âœ… æ·»åŠ  UserPlus å›¾æ ‡
  âœ… æ·»åŠ  "New Users" èœå•é¡¹

apps/web/src/app/dashboard/users/page.tsx
  âœ… æ·»åŠ æ–°ç”¨æˆ·è®¡æ•°æŸ¥è¯¢
  âœ… æ·»åŠ æç¤ºå¡ç‰‡
  âœ… æ·»åŠ æ–°ç”¨æˆ·æ ‡è®°

apps/web/src/app/dashboard/new-users/page.tsx
  âœ… æ–°å»ºé¡µé¢ï¼ˆå®Œæ•´å®ç°ï¼‰
```

### ç±»å‹å®šä¹‰
```
packages/shared/src/types/user.ts
  âœ… æ·»åŠ  isNewUser å­—æ®µ
  âœ… æ·»åŠ  reviewedAt å­—æ®µ
  âœ… æ·»åŠ  reviewedBy å­—æ®µ
```

---

## ğŸ¯ å¸¸è§é—®é¢˜

### Q: æ–°ç”¨æˆ·é»˜è®¤è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿ
A: æ–°ç”¨æˆ·é»˜è®¤åˆ›å»ºä¸º **Admin** è§’è‰²ï¼Œå¯ä»¥ç«‹å³è®¿é—® dashboardã€‚

### Q: å¦‚ä½•æ›´æ”¹æ–°ç”¨æˆ·çš„è§’è‰²ï¼Ÿ
A: åœ¨æ–°ç”¨æˆ·ç®¡ç†é¡µé¢ä¸­ï¼Œä½¿ç”¨ä¸‹æ‹‰èœå•é€‰æ‹©æ–°è§’è‰²ï¼Œç„¶åç‚¹å‡» "Approve"ã€‚

### Q: æ ‡è®°ç”¨æˆ·ä¸ºå·²å®¡æŸ¥åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
A: ç”¨æˆ·çš„ `isNewUser` å­—æ®µè®¾ç½®ä¸º `false`ï¼Œç”¨æˆ·ä»æ–°ç”¨æˆ·åˆ—è¡¨ä¸­ç§»é™¤ï¼Œä½†ä»ç„¶å‡ºç°åœ¨ä¸»ç”¨æˆ·åˆ—è¡¨ä¸­ã€‚

### Q: é superadmin å¯ä»¥è®¿é—®æ–°ç”¨æˆ·ç®¡ç†é¡µé¢å—ï¼Ÿ
A: ä¸å¯ä»¥ã€‚é superadmin ç”¨æˆ·ä¼šè¢«é‡å®šå‘åˆ° dashboardï¼Œå¹¶çœ‹åˆ°é”™è¯¯æç¤ºã€‚

### Q: å¦‚ä½•æŸ¥çœ‹å®¡æŸ¥å†å²ï¼Ÿ
A: åœ¨ Firestore ä¸­æŸ¥çœ‹ç”¨æˆ·æ–‡æ¡£çš„ `reviewedAt` å’Œ `reviewedBy` å­—æ®µã€‚

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£
- å®Œæ•´å®ç°è¯´æ˜ï¼š`NEW_USERS_FEATURE_IMPLEMENTATION.md`
- è¯¦ç»†æµ‹è¯•æŒ‡å—ï¼š`NEW_USERS_FEATURE_TEST_GUIDE.md`

### è°ƒè¯•
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. æŸ¥çœ‹åç«¯æ—¥å¿—
3. åœ¨ Firestore ä¸­éªŒè¯æ•°æ®
4. æ£€æŸ¥ç”¨æˆ·æƒé™

### æ”¯æŒ
- æŸ¥çœ‹ä»£ç æ³¨é‡Š
- æ£€æŸ¥ API æ–‡æ¡£
- è¿è¡Œæµ‹è¯•è„šæœ¬

---

## ğŸ‰ å®Œæˆï¼

æ–°ç”¨æˆ·ç®¡ç†åŠŸèƒ½å·²å®Œå…¨å®ç°ã€‚ç°åœ¨æ‚¨å¯ä»¥ï¼š

1. âœ… è‡ªåŠ¨æ ‡è®°æ–°ç”¨æˆ·
2. âœ… åœ¨ä¸“å±é¡µé¢ç®¡ç†æ–°ç”¨æˆ·
3. âœ… å®¡æŸ¥å’Œæ‰¹å‡†æ–°ç”¨æˆ·
4. âœ… æ›´æ”¹ç”¨æˆ·è§’è‰²
5. âœ… æŸ¥çœ‹å¾…å®¡æŸ¥æ–°ç”¨æˆ·æç¤º

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼

